---
- name: Reload systemd (freshrss)
  listen: reload systemd
  ansible.builtin.systemd:
    daemon_reload: true

- name: Check FreshRSS unit load state
  listen: restart freshrss
  ansible.builtin.command:
    cmd: systemctl show -p LoadState freshrss.service
  changed_when: false
  failed_when: false
  register: freshrss_load_state

- name: Restart FreshRSS service
  listen: restart freshrss
  ansible.builtin.systemd:
    name: freshrss.service
    state: restarted
  when:
    - freshrss_load_state.stdout is defined
    - "'LoadState=not-found' not in freshrss_load_state.stdout"
